language: rust
os: linux
dist: trusty
cache: cargo
rust:
- stable
- beta
- nightly
jobs:
  allow_failures:
  - rust: nightly
before_cache: |
  if [[ "$TRAVIS_RUST_VERSION" == stable ]]; then
    cargo install cargo-tarpaulin
  fi
script:
- cargo clean
- cargo build --verbose --all
- cargo test --lib --verbose -- --test-threads 1
after_success: |
  if [[ "$TRAVIS_RUST_VERSION" == stable ]]; then
    cargo tarpaulin --out Xml --ignore-tests -- --test-threads 1
    bash <(curl -s https://codecov.io/bash)
  fi
deploy:
  provider: cargo
  token:
    secure: acAoN1qkR2ncFKu05ANviZLL2zgH9pburT1w8NeZHgWURDZYE4Ru8ye3LUdQCdwtzCIT04NZRbZwafRGI5/KbrquVzsxIRFVblRuNlRO2BHDP20V17sfAmdjZDm3jbU3DJ74mGuSlrOXCkkWSUR2Lye3Od0LbQ6F84G0UUFWpPJKjKlriRBYtzD/9RrvoNhbxd/4HpHeTNtO2+4djzupfsPj+VPWWvKrRpRxDcIYo1tYysm547Kvq5lUryF38s72nc0Zf/QCUV8gHxjN7TY1CK537l/FZ8FaRMV8jm4zaASOX0heDuBzt7DWyPHtLpOsLZx4Us26jZ4f3i3ZEVwFxJRcHena63NjiwGzp9JfIKQnL+k9fgtmGiqkBMBTB47ykVQa7Eiu0G4s9dF6rY/haY2JkRpNDc1Ge0uIxsF33a0bghHjnGfRtR1S+ZY+7YsGyNJJPX50azR/ZZcb3BeAEpmeADI+haNt66Seowj0fSBjsn8MdsEY/FBZuCQk0Bjd1HYw0C0hTyIqhOpAMnl2QluB7lD5PHBC6aKnHwwL7vd7B9ZjB2MIpu9UzY/YN9awi8Cr9DvuJaqRacxPusRm8lNzpQRVzBaTkUo4a3yu8bHs6eY/M5aK/0RGkuEQ8Zv/MnwbZskBX6VzUHDS3v9oly4Z2ArTHdVK/QpLh6s18aQ=
  on:
    tags: true
notifications:
  email: false
